# ESP8266 Smart Lock Firmware

–£–º–Ω—ã–π –∑–∞–º–æ–∫ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ OTA –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏ –∏ OLED –¥–∏—Å–ø–ª–µ–µ–º.

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å OTA –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (–∫–∞–∂–¥—ã–µ 60 —Å–µ–∫)
```cpp
checkForUpdate() // –ö–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥ –≤ loop()
```

### 2. ESP8266 –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å
```
GET http://ota.alimov.top/firmware
Headers:
  User-Agent: ESP8266-http-Update/1.2.15
  x-esp8266-version: 1.2.15
```

### 3. OTA —Å–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–µ—Ä—Å–∏—é
- **–ï—Å–ª–∏ –≤–µ—Ä—Å–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–∞—è** ‚Üí `304 Not Modified`
- **–ï—Å–ª–∏ –µ—Å—Ç—å –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è** ‚Üí `200 OK` + —Ñ–∞–π–ª –ø—Ä–æ—à–∏–≤–∫–∏

### 4. ESP8266 –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç
```cpp
switch (ret) {
  case HTTP_UPDATE_NO_UPDATES:  // 304 - —É–∂–µ –∞–∫—Ç—É–∞–ª—å–Ω–∞—è
    printDisplay("FW up-to-date");
    break;
  case HTTP_UPDATE_OK:          // 200 - –Ω–æ–≤–∞—è –ø—Ä–æ—à–∏–≤–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞
    printDisplay("OTA Success! Restarting...");
    ESP.restart();
    break;
  case HTTP_UPDATE_FAILED:      // –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏
    printDisplay("OTA Failed");
    break;
}
```

### 5. –ü—Ä–æ—Ü–µ—Å—Å —É—Å—Ç–∞–Ω–æ–≤–∫–∏ (–ø—Ä–∏ UPDATE_OK)
1. ESP8266 –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–æ–≤—É—é –ø—Ä–æ—à–∏–≤–∫—É –≤–æ flash
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç MD5 —Ö—ç—à –¥–ª—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
3. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–µ–π
4. –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ –¥–∏—Å–ø–ª–µ–µ

## üì° –ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è

### UDP –∫–æ–º–∞–Ω–¥—ã (–ø–æ—Ä—Ç 2333)
```bash
echo "unlock" | nc -u <ESP_IP> 2333  # –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
echo "lock" | nc -u <ESP_IP> 2333    # –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
```

### HTTP —Å—Ç–∞—Ç—É—Å (–ø–æ—Ä—Ç 80)
```bash
curl http://<ESP_IP>/          # –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å JSON
curl -X POST http://<ESP_IP>/update  # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ OTA
```

## üì∫ OLED –î–∏—Å–ø–ª–µ–π
```
Locked | FW:1.2.15   O    # –°—Ç–∞—Ç—É—Å + –≤–µ—Ä—Å–∏—è + –∞–Ω–∏–º–∞—Ü–∏—è
IP: 192.168.1.100           # IP –∞–¥—Ä–µ—Å
Unlocks: 5                  # –°—á–µ—Ç—á–∏–∫ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
Uptime: 3600s               # –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```cpp
const char* firmwareUrl = "http://ota.alimov.top/firmware";
const unsigned long updateInterval = 60000; // 60 —Å–µ–∫
const unsigned int localPort = 2333;        // UDP –ø–æ—Ä—Ç
```

## üî® –°–±–æ—Ä–∫–∞

–í–µ—Ä—Å–∏—è –ø—Ä–æ—à–∏–≤–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ CI/CD:
```cpp
#define FIRMWARE_VERSION "%%FIRMWARE_VERSION%%"  // ‚Üí 1.2.15
```

–ü—Ä–∏ —Å–±–æ—Ä–∫–µ GitHub Actions –∑–∞–º–µ–Ω—è–µ—Ç –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä –Ω–∞ —Ä–µ–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é –∏–∑ `git describe`.
